<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Particle Variable Flow</title>
    <style>
        body {
            color: #ffeec7;
            background-color: #1e1d1b;
            margin: 0;
        }
    </style>
</head>
<body>
    <canvas></canvas>
</body>
<script type="text/javascript">
    class Particle {
        x = 0
        y = 0
        rad = 5
        clr = "red"
        constructor(opts={}, id, stage) {
            Object.assign(this, opts);

            this.id = id;
            this.stage = stage;
            this.sphereArea = 4 * Math.PI * this.rad ** 2;

            this.limX = this.stage.canvas.width;
            this.limY = this.stage.canvas.height;

            this.x = this.x || this.rnd_x;
            this.y = this.y || this.rnd_y;
        }
        next() {
            let velo = this.stage.get_velocities(this);

            this.vx = velo.x;
            this.vy = velo.y;

            this.x += this.vx;
            this.y += this.vy;

            if (this.x - this.rad > this.limX && this.vx >= 0) {
                this.x = 0 - this.rad;
            } else if (this.x + this.rad < 0 && this.vx < 0) {
                this.x = this.limX + this.rad;
            }

            if (this.y - this.rad > this.limY && this.vy >= 0) {
                this.y = 0 - this.rad;
            } else if (this.y + this.rad < 0 && this.vy < 0) {
                this.y = this.limY + this.rad;
            }

            return this
        }
        draw() {
            this.stage.ctx.fillStyle = this.clr || "#ffffff";
            this.stage.ctx.beginPath();
            this.stage.ctx.arc(this.x, this.y, this.rad, 0, 180);
            this.stage.ctx.fill();
        }
        get rnd_x() {
            return Math.ceil(Math.random() * this.limX);
        }
        get rnd_y() {
            return Math.ceil(Math.random() * this.limY);
        }
    }

    class Stage {
        particle_count = 100
        particles = []
        constructor(opts={}) {
            Object.assign(this, opts);
            this.init();
        }
        init() {
            this.particles = [];
            this.ctx = this.canvas.getContext('2d');

            for (let i = 0; i < this.particle_count; i++)
                this.particles.push(new Particle(this.particle_opts, i, this));
        }
        render() {
            this.ctx.globalAlpha = .2;
            this.ctx.fillStyle = '#000000';
            this.ctx.fillRect(0, 0, canvas.width, canvas.height);
            this.ctx.globalAlpha = 1;

            this.particles.forEach(p => {
                p.next().draw();
            });

            requestAnimationFrame(this.render.bind(this));
        }
        get_velocities(p) {
            this.velocities.forEach(b => {
                if (p.x > b.x && p.y > b.y && p.x < b.dx && p.y < b.dy) {
                    return {x: p.vx, y: p.vy}
                }
            });

            return { x: 0, y: 0 }
        }
    }

    const canvas = document.querySelector('canvas');
    canvas.width = innerWidth*.98;
    canvas.height = innerHeight*.98;

    const stage = new Stage({
        "canvas": canvas,
        "particle_count": 500,
        "velocities": [
            {x: 0, y: 0, dx: 40, dy: 30, vx: 1, vy: 0},
        ],
        "particle_opts": {
            x: null,
            y: null,
            get rad() {
                return .5;
            },
            get clr() {
                const colors = ["#e10869", "#30ad6f", "#f4782c", "#f7ed9c", "#0e94b2"];
                return "#fff"
            }
        }
    });

    stage.render();
</script>
</html>
